{% extends 'shop/layouts/main2.html' %}
{% block title %}
ShopKart | Favourite
{% endblock title %}        
 {% block content %}
 {% load static %}
 {% if fav %}
 <div class="container mt-5">
  <div class="col-12 text-center">
    <h4 class="text-white  px-4 py-2 d-inline-block rounded">
        
    </h4>
</div>
</div>
  <section class="my-3">
     <div class="container my-5">
        <div class="row">
           <div class="col-12">
              <div class="table-responsive">
                 <table class="table table-bordered text-center rounded-2">
                    <thead class="table-dark " >
                       <tr>
                          <th scope="col">Image</th>
                          <th scope="col">Product Name</th>
                          <th scope="col">Price</th>
                          <th scope="col">Remove</th>
                       </tr>
                    </thead>
                    <tbody>
                        {% for item in fav %}
                        <tr>
                            <input type="hidden" class="fid" value="{{ item.id }}">
                            <td class="align-middle"><img src="{{ item.product.product_image.url }}" height="75px" alt="{{ item.product.name }}"></td>
                            <td class="align-middle">{{ item.product.name }}</td>
                            <td class="align-middle">â‚¹{{ item.product.new_price | stringformat:'d' }}</td>
                            <td class="align-middle"><button class="btn btn-danger btn-sm fav-rem"><i class="fa fa-trash"></i></button></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    
                 </table>
                 
              </div>
              
           </div>
           
        </div>
        <div class="row my-3">
            <div class="col-12 d-flex flex-column flex-md-row gap-3 justify-content-center">
                <a href="/#trendy" id="placeOrder" class="btn btn-success w-100 w-md-25 p-3 place-order">
                    <i class="fa fa-heart"></i> Add More
                </a>  
                <button class="btn btn-danger w-100 w-md-25 p-3 clear-cart" id="delFav">
                    <i class="fa fa-trash"></i> Delete All
                </button>
            </div>
        </div>
     </div>
     
  </section>
  
</div>
  
  </div>
  {% else %}
  <div class="container text-center my-5">
   <img src="data:image/png;base64,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" alt="No Wishlist Items" class="img-fluid" style="max-width: 250px;">
   <h2 class="mt-4 text-dark">Your Wishlist is Empty!</h2>
   <p class="text-muted" style="font-size: 18px;">
       Save your favorite products for later. <br> 
       Start exploring and add items to your wishlist now!  
   </p>
   <a href="{% url 'collections' %}" class="btn btn-success mt-3 px-4 py-2" style="border-radius: 5px; font-size: 18px;">
       <i class="fas fa-heart me-2"></i> Browse Products
   </a>
</div>


  {% endif %}

  {% include 'shop/inc/loader.html' %}
  {% include 'shop/inc/alert.html' %}
  <script>
    const btnFavrem = document.getElementById('Favrem');
    const btnDeleteFav = document.getElementById("delFav");
    const Fid = document.getElementById('fid');
    const loader = document.getElementById("loader");
    document.addEventListener("DOMContentLoaded", function() {
        const btnDeleteFav = document.getElementById("delFav");
        const loader = document.getElementById("loader");
    
        // Attach event listener to all remove buttons dynamically
        document.querySelectorAll(".fav-rem").forEach(button => {
            button.addEventListener("click", function(event) {
                const fid = this.closest("tr").querySelector(".fid").value;  // Get the correct ID
    
                let postObject = { 'fid': fid };
                loader.style.display = "block";
    
                fetch("/remove_fav/", {
                    method: 'POST',
                    credentials: 'same-origin',
                    headers: {
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': '{{ csrf_token }}',
                    },
                    body: JSON.stringify(postObject)
                }).then(response => response.json())
                .then(data => {  
                    showPopup("Congratulations!", data['status']);
                    this.closest("tr").remove();  // Remove row from table
                });
            });
        });
    
        // Clear all favorites
        btnDeleteFav.addEventListener("click", function(event) {
            loader.style.display = "block";
            fetch("{% url 'delete_favourite' %}", {
                method: 'POST',
                credentials: 'same-origin',
                headers: {
                    'Accept': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': '{{ csrf_token }}',
                },
                body: JSON.stringify({})
            }).then(response => response.json())
            .then(data => {
                showPopup("Favourites cleared!", data['status']);
                document.querySelector("tbody").innerHTML = ""; // Clear table
            });
        });
    });
    
    // Function to show the popup
function showPopup(greeting, message) {
  const popup = document.getElementById('popup');
  const greet = document.getElementById('greet');
  const msg = document.getElementById('msg');
  const closePopupBtn = document.getElementById('closePopup');
  const img = document.getElementById('popImg')
  greet.innerHTML = greeting;
  msg.innerHTML = message;
  if (greeting === 'Oops! sorry') {
   img.src = "{% static 'images/wrong1.jpeg' %}";
   closePopupBtn.style.backgroundColor = "red";
} else {
   img.src = "{% static 'images/tick.jpeg' %}";
   closePopupBtn.style.backgroundColor = "#31d109";
}
  //close the loader
  // Show the popup
  loader.style.display = "none";
  popup.style.display = "block";
  

  // Handle closing the popup
  closePopupBtn.onclick = function() {
      popup.style.display = "none";
      window.location.href="{% url 'favview' %}";
      // Optional: Redirect or enable background elements
  };

  // Close popup if user clicks outside the popup content
  window.onclick = function(event) {
      if (event.target === popup) {
          popup.style.display = "none";
          window.location.href="{% url 'favview' %}";
      }
  };
}
  </script>  
 {% endblock content %}   